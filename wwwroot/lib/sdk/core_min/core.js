(p=>{function n(){return new Promise((a,e)=>{Fingerprint2.get(async e=>{var e=e.map(e=>e.value),e=Fingerprint2.x64hash128(e.join(""),31),t=(p.AppUser={platform:AppSettings.Platforms.web,nickName:e,avatar:App.info.logo,unionID:e},p.access_token=Cookies.get("access_token"),p.access_token||(t=await fetch(AppSettings.Server+"/api/appUsers/UnionIDSignIn",{headers:{"content-type":"application/json"},body:JSON.stringify({AppID:AppSettings.appid,UnionID:AppUser.unionID,Platform:AppUser.platform.id}),method:"POST"}),e=await t.json(),t.ok&&200==e.code?200==e.code&&(p.access_token=e.data.access_token,Cookies.set("access_token",p.access_token,{expires:e.data.expires_in})):!(t=await fetch(AppSettings.Server+"/api/appUsers/UnionIDSignUp",{headers:{"content-type":"application/json"},body:JSON.stringify({Appid:AppSettings.appid,UnionID:AppUser.unionID,Platform:AppUser.platform.id,Pwd:"123456",Avatar:AppUser.avatar}),method:"POST"})).ok||200==(e=await t.json()).code&&(p.access_token=e.data.access_token,Cookies.set("access_token",p.access_token,{expires:e.data.expires_in}))),await(await fetch(AppSettings.Server+"/api/appUsers/Profile",{headers:{Authorization:"Bearer "+access_token}})).json());p.AppUser={...AppUser,...t.data},await 0,a(p.AppUser)})})}p.AppSettings={Server:"https://www.oauthapp.com",Platforms:{web:{id:"web"},wechat:{id:"wechat",cookie_user:"_app_user_wechat"},weibo:{id:"weibo",cookie_user:"_app_user_weibo"},qq:{id:"qq",cookie_user:"_app_user_qq"}}},AppSettings={...AppSettings,...document.scripts.namedItem("appcore").dataset},p.putProfile=e=>{e&&(AppUser.data=e);e=Cookies.get("access_token");return $.ajax({url:AppSettings.Server+"/api/AppUsers/Profile",method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e},data:JSON.stringify({avatar:AppUser.avatar||"",nickName:AppUser.nickName,data:JSON.stringify(AppUser.data)||"{}"})})},p.AppOnReady=async e=>{var t=await(await fetch(`${AppSettings.Server}/api/apps/${AppSettings.appid}/Info`)).json(),a=(p.App=t.data,document.title=App.info.name,$("head").prepend('<link rel="shortcut icon" type="image/x-icon" href="'+App.info.logo+'" />'),$('<iframe style="display:none;" src="/favicon.ico"></iframe>'));return a.on("load",()=>{setTimeout(()=>{a.off("load").remove()},0)}).appendTo($("body")),App.info.tags&&$("head").prepend('<meta name="keywords" content="'+App.info.tags+'" />'),App.info.description&&$("head").prepend('<meta name="description" content="'+App.info.description+'" />'),1==e?await n():resolve(_res.data),new Promise((e,t)=>{e({App:App,AppUser:AppUser})})},"true"==AppSettings.autosignin&&AppOnReady(!0)})(window),(e=>{var p=AppSettings.Server+"/api/AppRank",n=AppSettings.appid;e.AppRanks=()=>$.ajax({url:p+`/${n}/Report`,method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+access_token}}),e.AppRank=(e,t,a)=>{t=["platform="+t,"take="+(a||30)];return $.ajax({url:p+`/${n}/${e}?`+t.join("&"),method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+access_token}})},e.AppRankMyIndex=(e,t,a)=>{t=["platform="+t,"unionid="+a];return $.ajax({url:p+`/${n}/${e}/Me?`+t.join("&"),method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+access_token}})},e.AppRankPostScore=(e,t)=>$.ajax({url:p+`/${n}/`+e,method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+access_token},data:JSON.stringify(t)})})(window),(e=>{var o=AppSettings.Server+"/api/AppStorage",i=AppSettings.appid;e.AppStorage=function(e,t="",a="",p="10",n="0"){e={url:o+`/${i}/Query?`+["tName="+e,"filter="+t,"sort="+a,"take="+p,"skip="+n].join("&"),method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+access_token}};return $.ajax(e)},e.AppStoragePost=function(e,t=""){e={url:o+`/${i}/Post?`+["tName="+e].join("&"),method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+access_token},data:t};return $.ajax(e)},e.AppStorageDelete=function(e){e={url:o+`/${i}/Delete?`+["id="+e].join("&"),method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer "+access_token}};return $.ajax(e)},e.AppStoragePut=function(e,t=""){e={url:o+`/${i}/Put?`+["id="+e].join("&"),method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+access_token},data:t};return $.ajax(e)},e.AppStorageTables=function(){var e={url:o+`/${i}/Tables`,method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+access_token}};return $.ajax(e)}})(window);